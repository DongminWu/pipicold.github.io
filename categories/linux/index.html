<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="PIPICOLD" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Linux - PIPICOLD</title><link rel="stylesheet" href="/css/main.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="head"><h1 class="head-title u-fl"><a href="/">PIPICOLD</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a href="/" class="head-nav__link">Home</a></li><li class="head-nav__item"><a href="/archives" class="head-nav__link">Archives</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"><time datetime="2016-03-16T23:00:00.000Z" class="post__time">March 17, 2016</time><h1 class="post__title"><a href="/2016/03/17/2016-03-17-Linux-Device-Tree-Study/">Some notes about Linux Device Tree</a></h1></header><div class="post__main echo"><h1 id="Part-1-Kernel-相关文档"><a href="#Part-1-Kernel-相关文档" class="headerlink" title="Part 1 Kernel 相关文档"></a>Part 1 Kernel 相关文档</h1><p>找到kernel的这个文档:</p>
<p><a href="">https://www.kernel.org/doc/Documentation/devicetree/bindings/mtd/partition.txt</a></p>
<p>这里面说的很清楚怎么给nand分区</p>
<h1 id="Part-2-关于-address-cells-size-cells-是什么意思"><a href="#Part-2-关于-address-cells-size-cells-是什么意思" class="headerlink" title="Part 2 关于 address-cells, size-cells 是什么意思"></a>Part 2 关于 address-cells, size-cells 是什么意思</h1><p>这得从 <code>reg</code> 字串开始说起,</p>
<p> <code>reg</code> 字串其实就是一个用来存某个空间的首地址和空间大小的存储器</p>
<p>但是呢, 受制于32bits的兼容问题, 所以首地址和空间大小必须以8byte=32bits的大小来存储</p>
<p>这就像英美数字表示法里面的逗号comma, 如果是999以下的数字用英美数字表示法就是纯粹的999, 但是大于等于1000的数字, 用英美数字表示法就变成了”1,000”.</p>
<p>这就可以说是在英美数字表示法里面用3位的10进制作为单位存储一个大数字.</p>
<p>类比在 Linux device tree里面, 它用 8位的16进制(=32位的二进制)作为单位存储一个大数字.</p>
<p>比如我们要表达一个8GB的数字, 十进制的8GB = 0x100000000 (8个0) , 用device tree 的表达方法就是应该为 8GB = 0x1 0x00000000</p>
<p>这样问题又来了, 作为程序, 我怎么知道一串数字 <0x1 0x00000001="" 0x1000000=""></0x1></p>
<p>哪一部分是空间首地址, 哪一部分是空间大小呢?</p>
<p>所以, 就有了 <code>#address-cells</code> , 和 <code>#size-cells</code> 这两个字段</p>
<p>这两个东西都是用来描述 <code>reg</code> 这个字串的, 他们描述了, 在描述首地址或者是空间大小时,使用了多少个8bytes 字符</p>
<p>举个栗子</p>
<p><img src="/img/2016-03-17/1.png" alt="example"></p>
<p>这个是kernel文档里面关于flash分区的一段描述</p>
<p>这个flash的分区里面的 #address-cell =1, #size-cells=2 所以, 在他的 <code>reg</code> 字段里面, 第一个8bytes 字符表示的是这个分区的起始地址, 第二和第三个8bytes字符表示的是这个分区的大小</p>
<p>关于一些其他的知识, 在kernel的文档里面说的很清楚: <a href="https://www.kernel.org/doc/Documentation/devicetree/booting-without-of.txt" target="_blank" rel="external">https://www.kernel.org/doc/Documentation/devicetree/booting-without-of.txt</a></p>
<blockquote>
<p>In general, the format of an address for a device is defined by the parent bus type, based on the <code>#address-cells</code> and <code>#size-cells</code> properties.  Note that the parent’s parent definitions of <code>#address-cells</code> and <code>#size-cells</code> are not inherited so every node with children must specify them.  The kernel requires the root node to have those properties defining addresses format for devices directly mapped on the processor bus.</p>
<p>Pasted from <a href="https://www.kernel.org/doc/Documentation/devicetree/booting-without-of.txt" target="_blank" rel="external">https://www.kernel.org/doc/Documentation/devicetree/booting-without-of.txt</a> </p>
</blockquote>
<p>另外这里提到的OF, 也就是Open Firmware, <a href="https://en.wikipedia.org/wiki/Open_Firmware" target="_blank" rel="external">https://en.wikipedia.org/wiki/Open_Firmware</a></p>
<p>这个是基于PowerPC的一个bootloader啦</p>
<h1 id="Part-3-博通的NAND的device-tree的描述格式"><a href="#Part-3-博通的NAND的device-tree的描述格式" class="headerlink" title="Part 3 博通的NAND的device tree的描述格式"></a>Part 3 博通的NAND的device tree的描述格式</h1><p>在这里, 讲的很清楚, 连例子都有</p>
<p><a href="">https://www.kernel.org/doc/Documentation/devicetree/bindings/mtd/brcm,brcmnand.txt</a></p>
</div><footer class="post__foot u-cf"><a href="/2016/03/17/2016-03-17-Linux-Device-Tree-Study/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-03-04T10:03:00.000Z" class="post__time">March 4, 2015</time><h1 class="post__title"><a href="/2015/03/04/2015-03-04-Liunx-command-one/">Linux学习笔记2</a></h1></header><div class="post__main echo"><h3 id="1-建立linux账号"><a href="#1-建立linux账号" class="headerlink" title="1. 建立linux账号"></a>1. 建立linux账号</h3><p>需要在ROOT权限下执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">useradd -m username</div></pre></td></tr></table></figure>
<p>新建一个用户名为<code>username</code>的账号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">passwd username</div></pre></td></tr></table></figure>
<p>为<code>username</code>用户创建密码</p>
<h3 id="2-nfs-server"><a href="#2-nfs-server" class="headerlink" title="2. nfs server"></a>2. nfs server</h3><p> In Fedora, the nfs-utils package is required for full NFS support. Run the following command to see if the nfs-utils is installed:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">~]$ rpm -q nfs-utils</div><div class="line">package nfs-utils is not installed</div></pre></td></tr></table></figure>
<p>If it is not installed and you want to use NFS, use the yum utility as root to install it:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">~]# yum install nfs-utils</div></pre></td></tr></table></figure>
<p>检查是否安装了nfs</p>
<pre><code>    rpm -qa |grep nfs

[kuaile@localhost ~]$ rpm -qa |grep nfs
nfs-utils-1.2.8-6.0.fc20.x86_64
libnfsidmap-0.25-7.fc20.x86_64
</code></pre><p>输出这就是已经安装了.</p>
<p>fedora 20 默认是已经安装的.</p>
<p>配置nfs</p>
<p>打开nfs配置文件exports</p>
<p>sudo vi /etc/exports</p>
<p>输入以下</p>
<pre><code>/home/kuaile 192.168.122.1(insecure,rw,sync,no_root_squash)
</code></pre><p>/home/kuaile       是共享的目录</p>
<p>192.168.122.1    是允许挂在该目录的主机的IP地址, 如果不能确定 ,请使用 * ,表示任意IP 都可以</p>
<p>insecure               是一个安全选项, 如果nfs服务端口号小于1024则可以不添加这个选项, 否则不添加的话, 是无法访问的.其他主机访问的话就会被拒绝.</p>
<p>rw                          是共享目录的权限,rw 是可读写的权限,只读的权限是ro.</p>
<p>sync                      是同步的选项, 可选的还有 async. sync是不使用缓存,随时写入同步, async是使用缓存的.</p>
<p>no_root_squash   是NFS 服务共享的目录的属性, 如果用户是root, 那么对这个目录就有root的权限.</p>
<p>如果有多个目录, 每个目录一行,可添加多个目录.</p>
</div><footer class="post__foot u-cf"><a href="/2015/03/04/2015-03-04-Liunx-command-one/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article><article class="post"><header class="post__head"><time datetime="2015-02-28T10:14:00.000Z" class="post__time">February 28, 2015</time><h1 class="post__title"><a href="/2015/02/28/2015-02-28-Happy-Birthday/">Linux学习笔记1</a></h1></header><div class="post__main echo"><p>这两天都在配置编译服务器,</p>
<h3 id="1-服务器的IP地址的问题"><a href="#1-服务器的IP地址的问题" class="headerlink" title="1. 服务器的IP地址的问题"></a>1. 服务器的IP地址的问题</h3><p>虚拟机的IP地址的问题搞定了.<br>修改/etc/sysconfig/network-scripts/ifcfg-ens32</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">TYPE=&quot;Ethernet&quot;</div><div class="line">BOOTPROTO=&quot;static&quot;</div><div class="line">DEFROUTE=&quot;yes&quot;</div><div class="line">IPV4_FAILURE_FATAL=&quot;no&quot;</div><div class="line">IPV6INIT=&quot;yes&quot;</div><div class="line">IPV6_AUTOCONF=&quot;yes&quot;</div><div class="line">IPV6_DEFROUTE=&quot;yes&quot;</div><div class="line">IPV6_FAILURE_FATAL=&quot;no&quot;</div><div class="line">NAME=&quot;ens32&quot;</div><div class="line">UUID=&quot;476287bc-8643-404f-984e-8fd719a2832f&quot;</div><div class="line">ONBOOT=&quot;yes&quot;</div><div class="line">HWADDR=&quot;00:50:56:8C:6E:82&quot;</div><div class="line">PEERDNS=&quot;yes&quot;</div><div class="line">PEERROUTES=&quot;yes&quot;</div><div class="line">IPV6_PEERDNS=&quot;yes&quot;</div><div class="line">IPV6_PEERROUTES=&quot;yes&quot;</div><div class="line">IPADDR=10.79.183.125</div><div class="line">NETMASK=255.255.255.0</div><div class="line">GATEWAY=10.79.183.1</div></pre></td></tr></table></figure>
<p>又遇到了一个dns的问题</p>
<p>在这个文件里面还需要添加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">DNS1=&quot;64.104.123.144&quot;</div><div class="line">DNS2=&quot;171.70.168.183&quot;</div></pre></td></tr></table></figure>
<h3 id="2-Sudo权限设置"><a href="#2-Sudo权限设置" class="headerlink" title="2. Sudo权限设置."></a>2. Sudo权限设置.</h3><p>主要是看了一个blog <a href="https://www.digitalocean.com/community/tutorials/how-to-edit-the-sudoers-file-on-ubuntu-and-centos" target="_blank" rel="external">How To Edit the Sudoers File on Ubuntu and CentOS</a></p>
<p>/etc/sudoers里面  </p>
<p><code>root        ALL=(ALL:ALL) ALL</code></p>
<p>这一行下面添加</p>
<p><code>demo        ALL=(ALL:ALL) ALL</code></p>
<p>就ok</p>
<h3 id="3-64位系统的交叉编译环境-arm-linux-gcc-不能使用的问题"><a href="#3-64位系统的交叉编译环境-arm-linux-gcc-不能使用的问题" class="headerlink" title="3. 64位系统的交叉编译环境 arm-linux-gcc 不能使用的问题."></a>3. 64位系统的交叉编译环境 arm-linux-gcc 不能使用的问题.</h3><p>有两个库找不到, <code>libz.so.1</code>和<code>ld-linux.so.2</code></p>
<p>google了一下, 问题是出在这个服务器是64位的, 有些32位的lib没有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum install glibc.i686</div><div class="line">yum install zlib.i686</div></pre></td></tr></table></figure>
<h3 id="4-fedora-设置环境变量"><a href="#4-fedora-设置环境变量" class="headerlink" title="4. fedora 设置环境变量"></a>4. fedora 设置环境变量</h3><p>修改/etc/profile文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PATH=/opt/tool:$PATH</div><div class="line">export PATH</div></pre></td></tr></table></figure>
<p>立即执行 环境变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">. /etc/profile</div></pre></td></tr></table></figure>
<p>注意 点 <code>.</code> 和 <code>/</code> 之间有个空格</p>
<h3 id="5-tftp-Server-on-Fedora-21"><a href="#5-tftp-Server-on-Fedora-21" class="headerlink" title="5. tftp Server on Fedora 21"></a>5. tftp Server on Fedora 21</h3><p>这个弄了我好久.</p>
<p>tftpServer的本质是用tftpd来作为server</p>
<p>但是可以用不同的服务来启动.</p>
<p>Fedora 18的文档是这样写的.</p>
<p>&gt;<br>On the DHCP server, verify that the tftp-server package is installed with the command rpm -q tftp-server.<br>tftp is an xinetd-based service. Configure xinetd to process tftp requests by editing /etc/xinetd.d/tftp so that disable = no.<br>Start the tftp service with the following commands:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">systemctl start xinetd.service</div><div class="line">systemctl enable xinetd.service</div></pre></td></tr></table></figure></p>
<p>These commands configure the tftp and xinetd services to immediately turn on and also configure them to start at boot.</p>
<p>但是到了Fedora 21的文档就变成了</p>
<p>&gt;</p>
<ol>
<li>Install the tftp server package.<br> yum install tftp-server</li>
<li>Start and enable the tftp socket. systemd will automatically start the tftpd service when required.<br> systemctl start tftp.socket<br> systemctl enable tftp.socket</li>
</ol>
<p>恩其实是两个不同的服务调用了同一个程序: /usr/sbin/in.tftpd</p>
<p>这个程序的帮助: man in.tftpd</p>
<h4 id="xinet"><a href="#xinet" class="headerlink" title="xinet"></a>xinet</h4><p>配置文件位置: /etc/xinet.d/tftp   没有的话就自己建立一个<br>配置如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">service tftp</div><div class="line">&#123;</div><div class="line">	disable		=	no</div><div class="line">	socket_type	=	dgram</div><div class="line">	protocol	=	udp</div><div class="line">	wait		=	yes</div><div class="line">	user		=	root</div><div class="line">	server		=	/usr/sbin/in.tftpd</div><div class="line">	server_args	=	-s /tftpboot</div><div class="line">	per_source	=	11</div><div class="line">	csp		    =	100 2</div><div class="line">	flags		=	IPv4</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注意的是:</p>
<ol>
<li>server_args 这一项是 in.tftpd的参数, 意思是把/tftpboot作为根目录</li>
<li>flags=IPv4是采用IPv4的端口,否则默认用的是IPv6的.</li>
</ol>
<h5 id="tftp-service-tftp-socket"><a href="#tftp-service-tftp-socket" class="headerlink" title="tftp.service / tftp.socket"></a>tftp.service / tftp.socket</h5><p>配置文件位置: <code>/usr/lib/systemd/system/tftp.service</code><br>内容:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[Unit]</div><div class="line">Description=Tftp Server</div><div class="line">Requires=tftp.socket</div><div class="line">Documentation=man:in.tftpd</div><div class="line"></div><div class="line">[Service]</div><div class="line">ExecStart=/usr/sbin/in.tftpd -s /tftpboot</div><div class="line">StandardInput=socket</div><div class="line"></div><div class="line">[Install]</div><div class="line">Also=tftp.socket</div></pre></td></tr></table></figure>
<p>IPV4的配置在 <code>/usr/lib/systemd/system/tftp.service</code><br>要配置成这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[Unit]</div><div class="line">Description=Tftp Server Activation Socket</div><div class="line"></div><div class="line">[Socket]</div><div class="line">ListenDatagram=0.0.0.0:69</div><div class="line"></div><div class="line">[Install]</div><div class="line">WantedBy=sockets.target</div></pre></td></tr></table></figure>
<p>重要的是ListenDatagram这一项</p>
<p><strong>配置成功!!!!</strong></p>
<p>要把selinux配置成自由模式(放纵模式?)</p>
<p><code>setenforce 0</code></p>
<p>linux的帮助这样写的</p>
<p>&gt;<br>setenforce(8)                               SELinux Command Line documentation                              setenforce(8)<br>NAME<br>       setenforce - modify the mode SELinux is running in<br>SYNOPSIS<br>       setenforce [Enforcing|Permissive|1|0]<br>DESCRIPTION<br>       Use Enforcing or 1 to put SELinux in enforcing mode.<br>       Use Permissive or 0 to put SELinux in permissive mode.<br>       If  SELinux  is  disabled  and you want to enable it, or SELinux is enabled and you want to disable it, please see<br>       selinux(8).<br>AUTHOR<br>       Dan Walsh, <a href="&#x6d;&#x61;&#105;&#108;&#116;&#x6f;&#58;&#x64;&#119;&#x61;&#x6c;&#115;&#104;&#64;&#114;&#x65;&#100;&#x68;&#x61;&#x74;&#x2e;&#x63;&#x6f;&#109;">&#x64;&#119;&#x61;&#x6c;&#115;&#104;&#64;&#114;&#x65;&#100;&#x68;&#x61;&#x74;&#x2e;&#x63;&#x6f;&#109;</a><br>SEE ALSO<br>       selinux(8), getenforce(8), selinuxenabled(8)<br>dwalsh@redhat.com                                      7 April 2004                                         setenforce(8)</p>
<h5 id="查看SELinux状态："><a href="#查看SELinux状态：" class="headerlink" title="查看SELinux状态："></a>查看SELinux状态：</h5><p>1、/usr/sbin/sestatus -v      ##如果SELinux status参数为enabled即为开启状态</p>
<p>SELinux status:                 enabled</p>
<p>2、getenforce                 ##也可以用这个命令检查</p>
<h5 id="关闭SELinux："><a href="#关闭SELinux：" class="headerlink" title="关闭SELinux："></a>关闭SELinux：</h5><p>1、临时关闭（不用重启机器）：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">setenforce 0                  <span class="comment">##设置SELinux 成为permissive模式</span></div><div class="line"></div><div class="line">                              <span class="comment">##setenforce 1 设置SELinux 成为enforcing模式</span></div></pre></td></tr></table></figure>
<p>2、修改配置文件需要重启机器：</p>
<p>修改/etc/selinux/config 文件</p>
<p>将SELINUX=enforcing改为SELINUX=disabled</p>
<h4 id="服务的启动"><a href="#服务的启动" class="headerlink" title="服务的启动"></a>服务的启动</h4><p>命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">systemctl status xinetd.service  //查看状态</div><div class="line"></div><div class="line">systemctl start xinetd.service   //启动</div><div class="line"></div><div class="line">systemctl stop xinetd.service    //停止</div><div class="line"></div><div class="line">systemctl restart xinetd.service //重启</div><div class="line"></div><div class="line">systemctl enable xinetd.service  //开机自启动</div></pre></td></tr></table></figure>
<h4 id="Samba-服务"><a href="#Samba-服务" class="headerlink" title="Samba 服务"></a>Samba 服务</h4><p><a href="http://docs.fedoraproject.org/en-US/Fedora/21/html/System_Administrators_Guide/ch-File_and_Print_Servers.html#samba-rgs-overview" target="_blank" rel="external">Fedora Samba配置文档</a></p>
<p><strong>1. 改/etc/samba/smb.conf 文件</strong></p>
<p>在最下面加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[dongmwu]</div><div class="line">path = /home/dongmwu</div><div class="line">writeable = yes</div><div class="line">public = yes</div><div class="line">guest ok = no</div></pre></td></tr></table></figure>
<p><strong>2. 设置密码</strong></p>
<p><code>smbpasswd -a username</code></p>
<p><strong>3. 重启samba服务</strong></p>
<p><code>systemctl restart smb.service</code></p>
<p><strong>4. 记住关防火墙!!!</strong></p>
<p><code>systemctl stop firewalld.service</code></p>
</div><footer class="post__foot u-cf"><a href="/2015/02/28/2015-02-28-Happy-Birthday/#disqus_thread" class="post__foot-link u-fr">0 COMMENTS</a></footer></article></main><footer class="foot"><div class="foot-copy u-fl">&copy; 2016 Dongmin Wu</div><menu class="page-menu u-fr"><li class="page-menu__item"><span title="Previous" class="page-menu__link icon-arrow-left page-menu__link--disabled"></span></li><li class="page-menu__item"><span title="Next" class="page-menu__link icon-arrow-right page-menu__link--disabled"></span></li></menu></footer></body></html>